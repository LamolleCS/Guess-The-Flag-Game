from utils.data import set_language as _set_data_language, CURRENT_LANGUAGE

_current_lang = CURRENT_LANGUAGE

# Translation dictionaries
_TRANSLATIONS = {
    'ES': {
        'menu.play': 'Jugar',
        'menu.settings': 'Configuración',
        'menu.language': 'Idioma',
        'menu.exit': 'Salir',
        'confirm.exit': '¿Seguro que te querés ir?',
        'region.global': 'Global',
        'region.by_continent': 'Por continente',
        'region.choose_mode': '¿Querés jugar por continente o global?',
        'region.choose_continent': 'Elegí un continente:',
        'mode.flags': 'Banderas',
        'mode.capitals': 'Capitales',
        'capitals.by_country': 'Por país',
        'capitals.by_capital': 'Por capital',
        'common.back': 'Volver',
        'common.skip': 'Saltear',
    'prompt.country': 'País: {country}',
    'prompt.capital': 'Capital: {capital}',
    'input.country_instruction': 'Escribí el nombre del país',
    'input.capital_instruction': 'Escribí la capital',
    'input.country_from_capital_instruction': 'Escribí el país',
        'msg.correct': '¡Bien ahí!',
    'msg.correct_full_name': '¡Bien ahí! Nombre completo: {country}',
        'msg.wrong_capital': 'Te equivocaste. La respuesta era: {answer}',
        'msg.wrong_country': 'Te equivocaste. La respuesta era: {answer}',
        'msg.almost_country': 'Casi, casi... La respuesta exacta era: {answer}',
        'msg.round_extra': '¡Ronda extra! Ahora solo con los que pifiaste o salteaste.',
        'msg.game_over': '¡Terminó el juego! Puntaje final: {score}/{total} | Máximo: {max_score} | Tiempo: {time}s',
    'msg.congrats_all': '¡Felicitaciones! Completaste todos sin errores finales.',
        'msg.congrats_completed': '¡Felicitaciones! Completaste todos. Puntaje final: {score}/{total} | Máximo: {max_score} | Tiempo: {time}s',
        'msg.skipped': 'Salteaste. La respuesta era: {answer}',
    'msg.skipped_flag': 'Salteaste. Era: {country}',
    'msg.skipped_capital_country': 'Salteaste. La capital de {country} era {capital}',
    'msg.skipped_capital_name': 'Salteaste. {capital} era la capital de {country}',
        'label.score': 'Puntaje',
        'label.max': 'Máximo',
    'settings.title': 'Configuración',
    'settings.volume': 'Volumen',
    'settings.resolution': 'Resolución',
    'settings.screen_mode': 'Modo de pantalla',
    'settings.apply': 'Aplicá',
    'settings.apply_hint': "Hacé clic en '{apply}' para guardar los cambios",
    'window.mode.windowed': 'Ventana',
    'window.mode.fullscreen': 'Pantalla completa',
    'window.mode.borderless': 'Pantalla completa sin bordes',
    },
    'EN': {
        'menu.play': 'Play',
        'menu.settings': 'Settings',
        'menu.language': 'Language',
        'menu.exit': 'Quit',
        'confirm.exit': 'Are you sure you want to quit?',
        'region.global': 'Global',
        'region.by_continent': 'By continent',
        'region.choose_mode': 'Do you want to play by continent or global?',
        'region.choose_continent': 'Pick a continent:',
        'mode.flags': 'Flags',
        'mode.capitals': 'Capitals',
        'capitals.by_country': 'By country',
        'capitals.by_capital': 'By capital',
        'common.back': 'Back',
        'common.skip': 'Skip',
    'prompt.country': 'Country: {country}',
    'prompt.capital': 'Capital: {capital}',
    'input.country_instruction': 'Type the country name',
    'input.capital_instruction': 'Type the capital',
    'input.country_from_capital_instruction': 'Type the country',
        'msg.correct': 'Nice!',
    'msg.correct_full_name': 'Nice! Full name: {country}',
        'msg.wrong_capital': 'Wrong. Correct answer: {answer}',
        'msg.wrong_country': 'Wrong. Correct answer: {answer}',
        'msg.almost_country': 'Almost... Exact answer was: {answer}',
        'msg.round_extra': 'Extra round! Only missed or skipped ones.',
        'msg.game_over': 'Game over! Final score: {score}/{total} | Best: {max_score} | Time: {time}s',
    'msg.congrats_all': 'Congratulations! You finished all correctly.',
        'msg.congrats_completed': 'Congratulations! You finished them all. Final score: {score}/{total} | Best: {max_score} | Time: {time}s',
        'msg.skipped': 'Skipped. Answer was: {answer}',
    'msg.skipped_flag': 'Skipped. It was: {country}',
    'msg.skipped_capital_country': 'Skipped. The capital of {country} was {capital}',
    'msg.skipped_capital_name': 'Skipped. {capital} was the capital of {country}',
        'label.score': 'Score',
        'label.max': 'Best',
    'settings.title': 'Settings',
    'settings.volume': 'Volume',
    'settings.resolution': 'Resolution',
    'settings.screen_mode': 'Display mode',
    'settings.apply': 'Apply',
    'settings.apply_hint': "Click '{apply}' to apply changes",
    'window.mode.windowed': 'Windowed',
    'window.mode.fullscreen': 'Fullscreen',
    'window.mode.borderless': 'Borderless fullscreen',
    },
    'PT': {
        'menu.play': 'Jogar',
        'menu.settings': 'Configurações',
        'menu.language': 'Idioma',
        'menu.exit': 'Sair',
        'confirm.exit': 'Tem certeza que deseja sair?',
        'region.global': 'Global',
        'region.by_continent': 'Por continente',
        'region.choose_mode': 'Quer jogar por continente ou global?',
        'region.choose_continent': 'Escolhe um continente:',
        'mode.flags': 'Bandeiras',
        'mode.capitals': 'Capitais',
        'capitals.by_country': 'Por país',
        'capitals.by_capital': 'Por capital',
        'common.back': 'Voltar',
        'common.skip': 'Pular',
    'prompt.country': 'País: {country}',
    'prompt.capital': 'Capital: {capital}',
    'input.country_instruction': 'Digite o nome do país',
    'input.capital_instruction': 'Digite a capital',
    'input.country_from_capital_instruction': 'Digite o país',
        'msg.correct': 'Boa!',
    'msg.correct_full_name': 'Boa! Nome completo: {country}',
        'msg.wrong_capital': 'Errado. Resposta: {answer}',
        'msg.wrong_country': 'Errado. Resposta: {answer}',
        'msg.almost_country': 'Quase... Resposta exata: {answer}',
        'msg.round_extra': 'Rodada extra! Só os que errou ou pulou.',
        'msg.game_over': 'Fim! Pontuação final: {score}/{total} | Máx: {max_score} | Tempo: {time}s',
    'msg.congrats_all': 'Parabéns! Completou todos corretamente.',
        'msg.congrats_completed': 'Parabéns! Terminou todos. Pontuação final: {score}/{total} | Máx: {max_score} | Tempo: {time}s',
        'msg.skipped': 'Pulou. Resposta: {answer}',
    'msg.skipped_flag': 'Pulou. Era: {country}',
    'msg.skipped_capital_country': 'Pulou. A capital de {country} era {capital}',
    'msg.skipped_capital_name': 'Pulou. {capital} era a capital de {country}',
        'label.score': 'Pontuação',
        'label.max': 'Máx',
    'settings.title': 'Configurações',
    'settings.volume': 'Volume',
    'settings.resolution': 'Resolução',
    'settings.screen_mode': 'Modo de exibição',
    'settings.apply': 'Aplicar',
    'settings.apply_hint': "Clique em '{apply}' para salvar",
    'window.mode.windowed': 'Janela',
    'window.mode.fullscreen': 'Tela cheia',
    'window.mode.borderless': 'Tela cheia sem bordas',
    },
    'DE': {
        'menu.play': 'Spielen',
        'menu.settings': 'Einstellungen',
        'menu.language': 'Sprache',
        'menu.exit': 'Beenden',
        'confirm.exit': 'Wirklich beenden?',
        'region.global': 'Global',
        'region.by_continent': 'Nach Kontinent',
        'region.choose_mode': 'Kontinent oder global spielen?',
        'region.choose_continent': 'Wähle einen Kontinent:',
        'mode.flags': 'Flaggen',
        'mode.capitals': 'Hauptstädte',
        'capitals.by_country': 'Nach Land',
        'capitals.by_capital': 'Nach Hauptstadt',
        'common.back': 'Zurück',
        'common.skip': 'Überspringen',
    'prompt.country': 'Land: {country}',
    'prompt.capital': 'Hauptstadt: {capital}',
    'input.country_instruction': 'Land eingeben',
    'input.capital_instruction': 'Hauptstadt eingeben',
    'input.country_from_capital_instruction': 'Land eingeben',
        'msg.correct': 'Gut!',
    'msg.correct_full_name': 'Gut! Vollständiger Name: {country}',
        'msg.wrong_capital': 'Falsch. Richtig: {answer}',
        'msg.wrong_country': 'Falsch. Richtig: {answer}',
        'msg.almost_country': 'Fast... Richtig war: {answer}',
        'msg.round_extra': 'Extrarunde! Nur falsche oder übersprungene.',
        'msg.game_over': 'Fertig! Endstand: {score}/{total} | Best: {max_score} | Zeit: {time}s',
    'msg.congrats_all': 'Glückwunsch! Alle korrekt abgeschlossen.',
        'msg.congrats_completed': 'Glückwunsch! Alles abgeschlossen. Endstand: {score}/{total} | Best: {max_score} | Zeit: {time}s',
        'msg.skipped': 'Übersprungen. Antwort: {answer}',
    'msg.skipped_flag': 'Übersprungen. Es war: {country}',
    'msg.skipped_capital_country': 'Übersprungen. Die Hauptstadt von {country} war {capital}',
    'msg.skipped_capital_name': 'Übersprungen. {capital} war die Hauptstadt von {country}',
        'label.score': 'Punkte',
        'label.max': 'Best',
    'settings.title': 'Einstellungen',
    'settings.volume': 'Lautstärke',
    'settings.resolution': 'Auflösung',
    'settings.screen_mode': 'Bildschirmmodus',
    'settings.apply': 'Übernehmen',
    'settings.apply_hint': "Klicke '{apply}' um zu speichern",
    'window.mode.windowed': 'Fenster',
    'window.mode.fullscreen': 'Vollbild',
    'window.mode.borderless': 'Randloses Vollbild',
    },
    'IT': {
        'menu.play': 'Gioca',
        'menu.settings': 'Impostazioni',
        'menu.language': 'Lingua',
        'menu.exit': 'Esci',
        'confirm.exit': 'Sei sicuro di uscire?',
        'region.global': 'Globale',
        'region.by_continent': 'Per continente',
        'region.choose_mode': 'Vuoi giocare per continente o globale?',
        'region.choose_continent': 'Scegli un continente:',
        'mode.flags': 'Bandiere',
        'mode.capitals': 'Capitali',
        'capitals.by_country': 'Per paese',
        'capitals.by_capital': 'Per capitale',
        'common.back': 'Indietro',
        'common.skip': 'Salta',
    'prompt.country': 'Paese: {country}',
    'prompt.capital': 'Capitale: {capital}',
    'input.country_instruction': 'Scrivi il paese',
    'input.capital_instruction': 'Scrivi la capitale',
    'input.country_from_capital_instruction': 'Scrivi il paese',
        'msg.correct': 'Bravo!',
    'msg.correct_full_name': 'Bravo! Nome completo: {country}',
        'msg.wrong_capital': 'Sbagliato. Risposta: {answer}',
        'msg.wrong_country': 'Sbagliato. Risposta: {answer}',
        'msg.almost_country': 'Quasi... Risposta esatta: {answer}',
        'msg.round_extra': 'Round extra! Solo quelli sbagliati o saltati.',
        'msg.game_over': 'Finito! Punteggio: {score}/{total} | Migliore: {max_score} | Tempo: {time}s',
    'msg.congrats_all': 'Complimenti! Hai completato tutto correttamente.',
        'msg.congrats_completed': 'Complimenti! Hai finito tutto. Punteggio finale: {score}/{total} | Record: {max_score} | Tempo: {time}s',
        'msg.skipped': 'Saltato. Risposta: {answer}',
    'msg.skipped_flag': 'Saltato. Era: {country}',
    'msg.skipped_capital_country': 'Saltato. La capitale di {country} era {capital}',
    'msg.skipped_capital_name': 'Saltato. {capital} era la capitale di {country}',
        'label.score': 'Punteggio',
        'label.max': 'Record',
    'settings.title': 'Impostazioni',
    'settings.volume': 'Volume',
    'settings.resolution': 'Risoluzione',
    'settings.screen_mode': 'Modalità schermo',
    'settings.apply': 'Applica',
    'settings.apply_hint': "Clic su '{apply}' per salvare",
    'window.mode.windowed': 'Finestra',
    'window.mode.fullscreen': 'Schermo intero',
    'window.mode.borderless': 'Schermo intero senza bordi',
    }
}

_FALLBACK_LANG = 'ES'

def set_ui_language(lang_code: str):
    global _current_lang
    if lang_code not in _TRANSLATIONS:
        lang_code = _FALLBACK_LANG
    _current_lang = lang_code
    _set_data_language(lang_code)


def tr(key: str, **kwargs):
    table = _TRANSLATIONS.get(_current_lang) or _TRANSLATIONS[_FALLBACK_LANG]
    text = table.get(key) or _TRANSLATIONS[_FALLBACK_LANG].get(key, key)
    if kwargs:
        try:
            return text.format(**kwargs)
        except Exception:
            return text
    return text


def current_language():
    return _current_lang
